# AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WAHA

## üéØ –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞ —Å WAHA —Å–∏—Å—Ç–µ–º–æ–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –∑–∞–∫–∞–∑–æ–≤.

## üöÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Kaspi Demper ‚Üí api_parser.py ‚Üí AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ ‚Üí WAHA ‚Üí WhatsApp
     ‚Üì              ‚Üì              ‚Üì           ‚Üì        ‚Üì
  –ó–∞–∫–∞–∑—ã      –¢—Ä–∏–≥–≥–µ—Ä AI      –ì–µ–Ω–µ—Ä–∞—Ü–∏—è    –û—Ç–ø—Ä–∞–≤–∫–∞   –ö–ª–∏–µ–Ω—Ç
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:
- `ai_seller_integration.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–º
- `kaspi_ai_integration.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- `api_parser_with_ai.py` - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API parser
- `main_with_ai.py` - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π main.py
- `ai_seller_config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `test_ai_integration.py` - –¢–µ—Å—Ç—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `ai_seller.env` - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install aiohttp asyncio logging

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞
cd ai-seller
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp ai_seller.env .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
nano .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞
cd ai-seller

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export OPENAI_API_KEY="your_openai_api_key"
export WAHA_API_ENDPOINT="http://localhost:3000"
export WAHA_SESSION_ID="kaspi_demper_session"
export GOOGLE_SHEET_URL="your_google_sheet_url"
```

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å–∫ AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

```bash
cd ai-seller
python main.py
```

### 2. –ó–∞–ø—É—Å–∫ WAHA —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd waha
./start_waha.sh
```

### 3. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

```bash
cd backend
python main_with_ai.py
```

## üì± API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### `GET /kaspi/get_sells_info/{shop_id}`
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö —Å AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–º

#### `GET /ai-seller/metrics`
–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

#### `POST /ai-seller/reset-metrics`
–°–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

#### `POST /ai-seller/trigger-delivered/{order_id}`
–¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

#### `GET /ai-seller/status`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

## üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
```python
# –í api_parser.py
async def get_sells_with_ai(shop_id):
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤
    result = get_sells_delivery_request(merchant_uid, cookies)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–º
    await process_orders_with_ai(result.get('orders', []), shop_id)
    
    return True, result
```

### 2. –¢—Ä–∏–≥–≥–µ—Ä AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞
```python
# –¢—Ä–∏–≥–≥–µ—Ä POST_PURCHASE
await ai_integration.trigger_post_purchase(customer_data)

# –¢—Ä–∏–≥–≥–µ—Ä ORDER_DELIVERED
await ai_integration.trigger_order_delivered(customer_data)
```

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
```python
# AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
ai_message = get_openai_response(prompt)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WAHA
send_waha_message(phone, ai_message)
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å

### Rate Limiting
- –ú–∞–∫—Å–∏–º—É–º 3 —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- Cooldown 24 —á–∞—Å–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –ú–∞–∫—Å–∏–º—É–º 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å

### Opt-out –º–µ—Ö–∞–Ω–∏–∑–º
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "—Å—Ç–æ–ø", "–æ—Ç–ø–∏—Å–∫–∞", "–Ω–µ –ø–∏—à–∏—Ç–µ", "stop"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ rate limiter

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
python test_ai_integration.py
```

### –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Kaspi AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Rate limiting
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```python
AISellerConfig(
    enabled=True,                    # –í–∫–ª—é—á–∏—Ç—å AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞
    ai_seller_url="http://localhost:8080",
    max_messages_per_customer=3,      # –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
    message_cooldown_hours=24,        # Cooldown –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    fallback_enabled=True,            # –í–∫–ª—é—á–∏—Ç—å fallback
    test_mode=False                   # –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
)
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
AI_SELLER_ENABLED=true
AI_SELLER_URL=http://localhost:8080
AI_SELLER_MAX_MESSAGES=3
AI_SELLER_COOLDOWN_HOURS=24
OPENAI_API_KEY=your_key
WAHA_API_ENDPOINT=http://localhost:3000
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
curl http://localhost:8080/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f ai-seller.log
```

### –ü—Ä–æ–±–ª–µ–º–∞: WAHA –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
curl http://localhost:3000/api/health

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ WAHA
cd waha && ./start_waha.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: OpenAI API –æ—à–∏–±–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á
export OPENAI_API_KEY="your_key"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã
curl -H "Authorization: Bearer $OPENAI_API_KEY" \
  https://api.openai.com/v1/usage
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤

### –°—Ç–æ–∏–º–æ—Å—Ç—å:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenAI API
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- Rate limiting –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM —Å–∏—Å—Ç–µ–º–∞–º–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
- –û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
