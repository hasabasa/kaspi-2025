# Django Backend –¥–ª—è Kaspi API Parser

–ú–∏–≥—Ä–∞—Ü–∏—è —Å FastAPI –Ω–∞ Django —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
playwright install chromium
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`.

### 3. –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
docker-compose up -d
```

### 4. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

#### 3.1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:

```bash
createdb kaspi_demper
```

#### 3.2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
python manage.py migrate
```

#### 3.3. –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
python manage.py createsuperuser
```

#### 3.4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
python manage.py runserver
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8010

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
django-backend/
‚îú‚îÄ‚îÄ kaspi_backend/          # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django
‚îÇ   ‚îú‚îÄ‚îÄ settings.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ urls.py            # –ì–ª–∞–≤–Ω—ã–µ URL –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py            # WSGI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ api/                   # –û—Å–Ω–æ–≤–Ω–æ–µ API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # –ú–æ–¥–µ–ª–∏ (KaspiStore, Product, Preorder)
‚îÇ   ‚îú‚îÄ‚îÄ views.py           # ViewSets –¥–ª—è REST API
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py     # –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã DRF
‚îÇ   ‚îî‚îÄ‚îÄ admin.py           # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ kaspi_auth/            # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Kaspi
‚îÇ   ‚îú‚îÄ‚îÄ views.py           # Views –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ session_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ kaspi_auth_service.py # Playwright –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ products/              # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ preorders/             # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤
‚îú‚îÄ‚îÄ manage.py              # Django CLI
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- `POST /api/v1/kaspi/auth/authenticate/` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Kaspi

### –ú–∞–≥–∞–∑–∏–Ω—ã

- `GET /api/v1/kaspi/stores/?user_id=<uuid>` - –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/kaspi/stores/` - –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
- `GET /api/v1/kaspi/stores/{id}/` - –î–µ—Ç–∞–ª–∏ –º–∞–≥–∞–∑–∏–Ω–∞
- `POST /api/v1/kaspi/stores/{id}/sync/` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
- `DELETE /api/v1/kaspi/stores/{id}/` - –£–¥–∞–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞

### –¢–æ–≤–∞—Ä—ã

- `GET /api/v1/products/` - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- `POST /api/v1/products/` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `GET /api/v1/products/{id}/` - –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
- `POST /api/v1/products/batch_enable/` - –ú–∞—Å—Å–æ–≤–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ
- `POST /api/v1/products/batch_disable/` - –ú–∞—Å—Å–æ–≤–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

### –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã

- `GET /api/v1/preorders/?store_id=<uuid>` - –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤
- `POST /api/v1/preorders/` - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞
- `GET /api/v1/preorders/{id}/` - –î–µ—Ç–∞–ª–∏ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞

### Health Checks

- `GET /health/` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /health/db/` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ Supabase).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

- `kaspi_stores` - –ú–∞–≥–∞–∑–∏–Ω—ã Kaspi
- `products` - –¢–æ–≤–∞—Ä—ã
- `preorders` - –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py makemigrations

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate
```

## üîß –û—Ç–ª–∏—á–∏—è –æ—Ç FastAPI –≤–µ—Ä—Å–∏–∏

1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥**: Django –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥, async —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–µ—Ä–Ω—É—Ç—ã —á–µ—Ä–µ–∑ `run_async()`
2. **ORM**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Django ORM –≤–º–µ—Å—Ç–æ asyncpg
3. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: Django REST Framework —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ Pydantic
4. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: Django URL routing –≤–º–µ—Å—Ç–æ FastAPI routers

## üìù TODO

- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–µ–º–ø–µ—Ä —Ü–µ–Ω
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å Celery –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

```bash
# –õ–æ–≥–∏ Django
tail -f logs/django.log

# Django shell
python manage.py shell

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
python manage.py showmigrations
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Django Documentation](https://docs.djangoproject.com/)
- [Django REST Framework](https://www.django-rest-framework.org/)
- [Playwright Python](https://playwright.dev/python/)

