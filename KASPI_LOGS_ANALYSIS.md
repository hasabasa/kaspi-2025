# üîç –ê–ù–ê–õ–ò–ó –ó–ê–ü–†–û–°–û–í –ò –õ–û–ì–û–í KASPI –î–ï–ú–ü–ï–†–ê

## üìä –°–•–ï–ú–ê –ó–ê–ü–†–û–°–û–í BACKEND

### 1. üîê KASPI –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (Selenium)

**URL:** `https://idmc.shop.kaspi.kz/login`
**–ú–µ—Ç–æ–¥:** Selenium WebDriver (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. –û—Ç–∫—Ä—ã—Ç—å Chrome –≤ headless —Ä–µ–∂–∏–º–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://idmc.shop.kaspi.kz/login
3. –í–≤–µ—Å—Ç–∏ email –≤ –ø–æ–ª–µ "username"
4. –ù–∞–∂–∞—Ç—å "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
5. –í–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å –≤ –ø–æ–ª–µ "password" 
6. –ù–∞–∂–∞—Ç—å "–í–æ–π—Ç–∏"
7. –ü–æ–ª—É—á–∏—Ç—å cookies –∏ —Ç–æ–∫–µ–Ω—ã
8. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Supabase
```

**–õ–æ–≥–∏:**
- `üîê [KASPI-AUTH]` - –Ω–∞—á–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `üìß [KASPI-AUTH]` - email –∏ –º–µ—Ç–æ–¥
- `üöÄ [KASPI-AUTH]` - –≤—ã–∑–æ–≤ auth_manager.login
- `üìä [KASPI-AUTH]` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 2. üì¶ –ü–ê–†–°–ò–ù–ì –¢–û–í–ê–†–û–í (Kaspi API)

**URL:** `https://kaspi.kz/api/merchantcabinet/api/offers`
**–ú–µ—Ç–æ–¥:** POST —Å cookies –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```json
{
  "Content-Type": "application/json",
  "Cookie": "session_id=xxx; merchant_token=yyy",
  "User-Agent": "Mozilla/5.0...",
  "Referer": "https://kaspi.kz/merchantcabinet/offers"
}
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "page": 1,
  "size": 20,
  "sort": "PRICE_ASC"
}
```

**–õ–æ–≥–∏:**
- `üîç [PARSER]` - –Ω–∞—á–∞–ª–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–æ–≤–∞—Ä–∞
- `üåê [PARSER]` - URL –∑–∞–ø—Ä–æ—Å–∞
- `üìã [PARSER]` - –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- `üì¶ [PARSER]` - —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
- `üîÑ [PARSER]` - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–∫—Å–∏
- `üöÄ [PARSER]` - –æ—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞
- `üìä [PARSER]` - –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç (—Å—Ç–∞—Ç—É—Å)
- `üìÑ [PARSER]` - —Ä–∞–∑–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `üí∞ [PARSER]` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- `üíµ [PARSER]` - —Ü–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- `üèÜ [PARSER]` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞

### 3. üí∞ –î–ï–ú–ü–ï–† –¶–ï–ù (Kaspi API)

**URL:** `https://kaspi.kz/api/merchantcabinet/api/offers/{offer_id}/price`
**–ú–µ—Ç–æ–¥:** PUT –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
2. –ù–∞–π—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–æ–≤—É—é —Ü–µ–Ω—É (–Ω–∞ 1‚Ç∏ –º–µ–Ω—å—à–µ)
4. –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É —á–µ—Ä–µ–∑ API
5. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

**–õ–æ–≥–∏:**
- `üîç [DEMPER]` - –∞–Ω–∞–ª–∏–∑ —Ü–µ–Ω –¥–ª—è SKU
- `üì¶ [DEMPER]` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `üîÑ [DEMPER]` - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–∫—Å–∏
- `üí∞ [DEMPER]` - —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
- `üíµ [DEMPER]` - —Ü–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- `üìà [DEMPER]` - —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏
- `‚úÖ [DEMPER]` - —Ä–µ—à–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### 4. üóÑÔ∏è SUPABASE –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

**URL:** `https://your-project.supabase.co/rest/v1/`
**–ú–µ—Ç–æ–¥:** POST/GET/PUT/DELETE

**–¢–∞–±–ª–∏—Ü—ã:**
- `kaspi_stores` - –º–∞–≥–∞–∑–∏–Ω—ã
- `products` - —Ç–æ–≤–∞—Ä—ã
- `sales` - –ø—Ä–æ–¥–∞–∂–∏
- `demper_sessions` - —Å–µ—Å—Å–∏–∏ –¥–µ–º–ø–µ—Ä–∞
- `demper_logs` - –ª–æ–≥–∏ –¥–µ–º–ø–µ—Ä–∞
- `proxy_configs` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏
- `proxy_logs` - –ª–æ–≥–∏ –ø—Ä–æ–∫—Å–∏

**–õ–æ–≥–∏:**
- `üîç [SUPABASE]` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `üì¶ [SUPABASE]` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
- `‚úÖ [SUPABASE]` - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `‚ùå [SUPABASE]` - –æ—à–∏–±–∫–∏ —Å traceback

## üö® –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —ç–º–æ–¥–∑–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—è—Å–Ω—ã–µ URL –∑–∞–ø—Ä–æ—Å–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö URL, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ —Ç–µ–ª –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–∫—Å–∏
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

## üìã –ö–ê–ö –ß–ò–¢–ê–¢–¨ –õ–û–ì–ò

1. **–ò—â–∏—Ç–µ —ç–º–æ–¥–∑–∏** - –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
2. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ URL** - –ø–æ–Ω–∏–º–∞–π—Ç–µ –∫—É–¥–∞ –∏–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å—ã** - 200 OK, 401 Unauthorized, 500 Error
4. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** - traceback –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏

## üîß –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

–í—Å–µ –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å backend –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
–î–ª—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `logs/` –≤ unified-backend.
