# üìä –†–µ–∑—é–º–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Django

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `unified-backend` (FastAPI) —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `django-backend` (Django + PostgreSQL).

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤**: 33 Python —Ñ–∞–π–ª–∞
- **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Ñ—É–Ω–∫—Ü–∏–π**: 20+ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–°–æ–∑–¥–∞–Ω–æ —Å–µ—Ä–≤–∏—Å–æ–≤**: 5 —Å–µ—Ä–≤–∏—Å–æ–≤
- **Management commands**: 1 (demper)
- **API endpoints**: 15+ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üîÑ –ß—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ ‚úÖ
- `get_products()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ API Kaspi
- `sync_store_api()` - –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
- `insert_product_if_not_exists()` - –≤—Å—Ç–∞–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
- `map_offer()` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤

### 2. –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ ‚úÖ
- `parse_product_by_sku()` - –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ –ø–æ SKU
- `sync_product()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ –≤ Kaspi
- `get_random_headers()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### 3. –î–µ–º–ø–µ—Ä —Ü–µ–Ω ‚úÖ
- Management command `python manage.py demper`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω

### 4. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úÖ
- Email/Password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Playwright
- SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`sms_login_start`, `sms_login_verify`)
- SessionManager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–π

### 5. –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã ‚úÖ
- `fetch_preorders()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤
- `handle_upload_preorder()` - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Kaspi
- `generate_preorder_xlsx()` - —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel
- `process_preorders_for_excel()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Excel

### 6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã ‚úÖ
- Proxy –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- Error handlers –¥–ª—è Playwright
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
django-backend/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync_service.py      # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser_service.py    # –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ proxy_service.py     # Proxy –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ management/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ demper.py         # –î–µ–º–ø–µ—Ä —Ü–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ models.py                 # –ú–æ–¥–µ–ª–∏ (KaspiStore, Product, Preorder)
‚îÇ   ‚îú‚îÄ‚îÄ views.py                  # ViewSets –¥–ª—è API
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py            # DRF —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ admin.py                  # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ kaspi_auth/
‚îÇ   ‚îú‚îÄ‚îÄ kaspi_auth_service.py     # Playwright –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ sms_auth_service.py       # SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ session_manager.py        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ error_handlers.py         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ views.py                  # Auth endpoints
‚îî‚îÄ‚îÄ preorders/
    ‚îî‚îÄ‚îÄ services.py               # –°–µ—Ä–≤–∏—Å—ã –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤
```

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/v1/kaspi/auth/authenticate/` - Email/Password
- `POST /api/v1/kaspi/auth/sms_start/` - –ù–∞—á–∞–ª–æ SMS
- `POST /api/v1/kaspi/auth/sms_verify/` - –ü—Ä–æ–≤–µ—Ä–∫–∞ SMS

### –ú–∞–≥–∞–∑–∏–Ω—ã
- `GET /api/v1/kaspi/stores/?user_id=<uuid>` - –°–ø–∏—Å–æ–∫
- `POST /api/v1/kaspi/stores/` - –°–æ–∑–¥–∞–Ω–∏–µ
- `POST /api/v1/kaspi/stores/{id}/sync/` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `DELETE /api/v1/kaspi/stores/{id}/` - –£–¥–∞–ª–µ–Ω–∏–µ

### –¢–æ–≤–∞—Ä—ã
- `GET /api/v1/products/` - –°–ø–∏—Å–æ–∫
- `POST /api/v1/products/` - –°–æ–∑–¥–∞–Ω–∏–µ
- `POST /api/v1/products/offers_by_product/` - –û—Ñ—Ñ–µ—Ä—ã –ø–æ SKU
- `POST /api/v1/products/update_price/` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
- `POST /api/v1/products/batch_enable/` - –ú–∞—Å—Å–æ–≤–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ
- `POST /api/v1/products/batch_disable/` - –ú–∞—Å—Å–æ–≤–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

### –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã
- `GET /api/v1/preorders/` - –°–ø–∏—Å–æ–∫
- `GET /api/v1/preorders/list_by_store/` - –ü–æ –º–∞–≥–∞–∑–∏–Ω—É
- `POST /api/v1/preorders/upload/` - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Kaspi
- `POST /api/v1/preorders/generate_excel/` - Excel —ç–∫—Å–ø–æ—Ä—Ç

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Django –≤–µ—Ä—Å–∏–∏

1. **ORM –≤–º–µ—Å—Ç–æ raw SQL** - —É–¥–æ–±–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å SQL –≤—Ä—É—á–Ω—É—é
3. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ Django
4. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ apps
5. **Management commands** - —É–¥–æ–±–Ω—ã–µ CLI –∫–æ–º–∞–Ω–¥—ã
6. **DRF** - –º–æ—â–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è REST API

## ‚ö†Ô∏è –û—Ç–ª–∏—á–∏—è –æ—Ç FastAPI

1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥** - async —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–µ—Ä–Ω—É—Ç—ã —á–µ—Ä–µ–∑ `run_async()`
2. **ORM** - Django ORM –≤–º–µ—Å—Ç–æ asyncpg
3. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** - DRF —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ Pydantic
4. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - Django URL routing –≤–º–µ—Å—Ç–æ FastAPI routers

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
2. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ production –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Celery –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
5. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

## üóëÔ∏è –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å unified-backend

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å `unified-backend/`, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã!

```bash
# –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
mkdir -p archive
cp -r unified-backend archive/

# –£–¥–∞–ª–∏—Ç—å
rm -rf unified-backend/
```

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-01-16  
**–í–µ—Ä—Å–∏—è Django**: 5.0.1  
**–í–µ—Ä—Å–∏—è DRF**: 3.14.0

